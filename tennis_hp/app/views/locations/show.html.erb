<div class="page-header">
  <%= link_to locations_path, class: 'btn btn-default' do %>
    <span class="glyphicon glyphicon-list-alt"></span>
    Back
  <% end %>
  <%= link_to edit_location_path(@location), class: 'btn btn-primary' do %>
    <span class="glyphicon glyphicon-pencil"></span>
    Edit
  <% end %>
  <h1>Location Details</h1>
</div>

<dl class="dl-horizontal">
  <dt>Location Name:</dt>
  <dd><%= @location.address %></dd>

  <dt>Latitude:</dt>
  <dd><%= @location.latitude %></dd>

  <dt>Longitude:</dt>
  <dd><%= @location.longitude %></dd>

</dl>

<!-- Map Section -->

<!-- <div id="map_canvas"></div>

<div id="addresses">
    <div class="address-panel">
        <h4>Current Location</h4>
        <address>
          <%= 'enter current location here' %>
        </address>
    </div>

<div id="addresses">
    <div class="address-panel">
        <h4>Destination</h4>
        <address>
          <%= @location.address %>
        </address>
</div> -->

  <!-- Google Maps and Places API (https://www.youtube.com/watch?v=keO6egndYrE) -->
  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=true"></script>

<!-- Map Creation -->
<h4>Current Location</h4>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">

  var map;
  var service;
  var currentLocation;

  // Manage the results returned from additional tennis court search
  function handleSearchResults(results, status) {
      console.log(results);
      for(var i = 0; i < results.length; i++) {

        var marker = new google.maps.Marker({
            position: results[i].geometry.location,
            map: map,
            icon: "t_racket.png"
        });
      }
  }

  // Locates all tennis courts, within the bounds of the map.
  function performSearch() {
    var request = {
        bounds: map.getBounds(),
        name: "Sharon Lester Tennis Center",
        icon: "t_racket.png"
    }
  service.nearbySearch(request, handleSearchResults);

  }

  function initialize(location) {
    console.log(location);
    currentLocation = new google.maps.LatLng(location.coords.latitude, location.coords.longitude);
    var mapProp = {
                  center: currentLocation,
                  zoom: 14,
                  mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    map = new google.maps.Map(document.getElementById("map-canvas"), mapProp);

    var marker = new google.maps.Marker({
                                        position: currentLocation,
                                        map: map,
                                        title: 'You Are Here'
    });

    service = new google.maps.places.PlacesService(map);

    // Ensures the map bounds are initialized before the search is performed.
    google.maps.event.addListenerOnce(map, 'bounds_changed', performSearch);

    // redo search when the refresh button is clicked
    $('#refresh').click(performSearch);

    // traffic layer
    var trafficLayer = new google.maps.TrafficLayer();
    $('#toggle_traffic').click(function () {
        if (trafficLayer.getMap()) {
            trafficLayer.setMap(null);
        }
        else {
            trafficLayer.setMap(map);
        }
    });
  }

  $(document).ready(function() {
    navigator.geolocation.getCurrentPosition(initialize);
  });

</script>

<div id="map-canvas"></div>
<button id="refresh">Refresh</button>
<button id="toggle_traffic">Traffic</button>
<button id="toggle_weather">Weather</button>
<!-- END Google Map - VERSION2 -->